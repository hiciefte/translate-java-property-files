# Repository Structure

This document outlines the structure and purpose of the files and directories within this project.

## Root Directory

- **`.git/`**: Contains Git version control information.
- **`.github/`**: Contains GitHub-specific files like workflows or issue templates.
  - **`workflows/`**: Contains GitHub Actions workflow files.
    - **`build-verify.yml`**: Defines a CI workflow that runs on pull requests. It lints the Dockerfile, scans dependencies and the final image for vulnerabilities, and verifies that the Docker image can be built successfully.
- **`docker/`**: Contains all files for building and running the Dockerized application.
  - **`Dockerfile`**: Defines the Docker image, installs dependencies (Python, Git, GPG, CLIs), sets up `appuser`, and imports the bot GPG key.
  - **`docker-compose.yml`**: Configures the Docker service (`translator`), manages environment variables (from `docker/.env` by default), and volume mounts.
  - **`config.docker.yaml`**: Configuration file used *inside* the Docker container (mounted as `/app/config.yaml` by `docker-compose.yml`).
  - **`translator-cron`**: Crontab file defining the scheduled execution of `update-translations.sh` via the entrypoint.
  - **`docker-entrypoint.sh`**: Script run on container start; manages repository cloning/updating, GPG/user environment setup, and starts cron.
  - **`.env.example`**: Example environment variable file. The user must copy this to `docker/.env` and customize it.
- **`docs/`**: Contains project documentation.
  - **`repository-structure.md`**: This file.
- **`logs/`**: (Created by the application, should be in `.gitignore`) Stores runtime logs from cron, `update-translations.sh`, and `translate_localization_files.py`.
- **`secrets/`**: (Must be in `.gitignore`) Stores sensitive files.
  - **`gpg_bot_key/`**: Contains the bot's GPG public (`bot_public_key.asc`) and secret (`bot_secret_key.asc`) keys, copied into the Docker image.
- **`src/`**: Contains the main Python source code for the translation utilities.
- **`tests/`**: (If present) Contains test files for the project.
- **`venv/`**: (If used for local development) Contains Python virtual environment files.
- **`.gitignore`**: Specifies intentionally untracked files that Git should ignore.
- **`.hadolint.yaml`**: Configuration file for the `hadolint` Dockerfile linter.
- **`.trivyignore`**: Configuration file for the `Trivy` vulnerability scanner.
- **`config.yaml`**: Configuration file for **manual/local runs**.
- **`config.example.yaml`**: Example for `config.yaml`.
- **`glossary.json`**: Contains a glossary of terms for translation.
- **`requirements.in`**: Defines the high-level **production** dependencies. Edit this file to manage dependencies, then run `pip-compile`.
- **`requirements-dev.in`**: Defines high-level **development and testing** dependencies.
- **`requirements.txt`**: An auto-generated lockfile containing pinned production dependencies. Do not edit this file directly.
- **`requirements-dev.txt`**: An auto-generated lockfile for development dependencies.
- **`update-translations.sh`**: Main orchestration shell script, run by cron inside the Docker container to perform the end-to-end translation workflow.
- **`LICENSE`**: Project's license file.
- **`README.md`**: The primary project overview and setup guide.
- **`SECURITY_STRATEGY.md`**: Outlines the security strategy for the project.

## Key Files Overview

- **`docker/Dockerfile`**: Defines the Docker image. It sets up an Ubuntu environment, installs all necessary system and Python packages, creates a non-root `appuser`, and imports a dedicated bot GPG key.

- **`docker/docker-compose.yml`**: Configures and runs the `translator` Docker service, managing environment variables, build arguments, and volume mounts.

- **`docker/docker-entrypoint.sh`**: The script run on container start. It handles cloning/updating the target repository, setting up the `appuser` environment (GPG, Git), and starting the `cron` daemon.

- **`src/translate_localization_files.py`**: The core Python script that loads configuration, parses `.properties` files, interacts with the OpenAI API for translations, and writes the results.

- **`update-translations.sh`**: The main orchestration script. It sets up a Python virtual environment, installs dependencies from the `requirements.txt` lockfile, pulls from Transifex, runs the translation script, and manages the Git workflow (branching, committing, creating a PR, and pushing to Transifex).

- **`requirements.in` / `requirements-dev.in`**: These files define the high-level dependencies for production and development, respectively. They are the **source of truth** for package management.

- **`requirements.txt` / `requirements-dev.txt`**: These are lockfiles generated by `pip-tools` from the `.in` files. They contain the exact, pinned versions of all direct and transitive dependencies, ensuring reproducible builds. **Do not edit these files manually.**

- **`README.md`**: Provides the most current and comprehensive overview of the project, including prerequisites, setup instructions for Docker, configuration of `.env` and GPG/SSH keys, Docker usage, server deployment with systemd, manual usage, and the overall workflow. It should be considered the primary source of truth for setting up and running the service.

## `src/` Directory

- **`__pycache__/`**: (Should be in `.gitignore`) Contains bytecode cache files generated by Python.
- **`translate_localization_files.py`**: The main Python script responsible for handling the translation of localization files.

## `tests/` Directory

- **`.pytest_cache/`**: (Should be in `.gitignore`) Cache directory for pytest specific to tests.

- **`update-translations.sh`**: This shell script, located in the project root and copied to `/app/` in the Docker image, automates the end-to-end translation update process when run inside the container as `appuser`. It performs the following:
    - Sets up a Python virtual environment in `appuser`'s home and installs dependencies from `/app/requirements.txt`.
    - Loads `TX_TOKEN` (Transifex API token) from the environment.
    - Reads configuration (e.g., `target_project_root`) from `/app/config.yaml`.
    - **Conditionally pushes** updated source translations to Transifex using `tx push -t` **only if the GitHub PR creation was successful.**
    - Returns to the original Git branch (`main`).

- **`glossary.json`**: A JSON file in the project root, mounted into `/app/glossary.json` in Docker. It stores language-specific glossaries used by `src/translate_localization_files.py` to ensure consistent translation of key terms.

- **`requirements.txt`**: Lists the pinned, auto-generated Python dependencies (e.g., `openai`, `PyYAML`, `tiktoken`) needed for `src/translate_localization_files.py`. It is generated from `requirements.in` by `pip-tools` and installed into a virtual environment by `update-translations.sh`.

- **`README.md`**: Provides the most current and comprehensive overview of the project, including prerequisites, setup instructions for Docker, configuration of `.env` and GPG/SSH keys, Docker usage, server deployment with systemd, manual usage, and the overall workflow. It should be considered the primary source of truth for setting up and running the service.